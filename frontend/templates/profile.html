{% extends "base.html" %}

{% block title %}Profile - AI Job Qualification System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h2 mb-1">Your Profile</h1>
                <p class="text-muted mb-0">Manage your qualifications and preferences</p>
            </div>
            <div class="text-end">
                <div id="profile-status" class="mb-2">
                    <span id="completion-badge" class="badge bg-secondary">Loading...</span>
                </div>
                <button type="button" class="btn btn-primary" onclick="saveProfile()">
                    <i class="fas fa-save me-1"></i> Save Profile
                </button>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <form id="profile-form" method="POST" action="{{ url_for('update_profile') }}">
            <!-- Basic Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-user me-2"></i>Basic Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="years_of_experience" class="form-label">Years of Experience</label>
                                <input type="number" class="form-control" id="years_of_experience" name="years_of_experience" 
                                       min="0" max="50" placeholder="e.g., 3" value="{{ profile.years_of_experience if profile and profile.years_of_experience != None else '' }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="experience_level" class="form-label">Experience Level *</label>
                                <select class="form-select" id="experience_level" name="experience_level" required>
                                    <option value="">Select experience level</option>
                                    <option value="entry" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'entry' else '' }}>Entry Level</option>
                                    <option value="junior" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'junior' else '' }}>Junior</option>
                                    <option value="mid" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'mid' else '' }}>Mid Level</option>
                                    <option value="senior" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'senior' else '' }}>Senior Level</option>
                                    <option value="lead" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'lead' else '' }}>Lead</option>
                                    <option value="executive" {{ 'selected' if profile and profile.experience_level and profile.experience_level.value == 'executive' else '' }}>Executive</option>
                                </select>
                            </div>
                </div>
            </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="education_level" class="form-label">Education Level *</label>
                                <select class="form-select" id="education_level" name="education_level" required>
                                    <option value="">Select education level</option>
                                    <option value="high_school" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'high_school' else '' }}>High School Diploma</option>
                                    <option value="associates" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'associates' else '' }}>Associate's Degree</option>
                                    <option value="bachelors" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'bachelors' else '' }}>Bachelor's Degree</option>
                                    <option value="masters" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'masters' else '' }}>Master's Degree</option>
                                    <option value="phd" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'phd' else '' }}>Doctoral Degree (e.g., Ph.D., Ed.D., D.B.A.)</option>
                                    <option value="other" {{ 'selected' if profile and profile.education_level and profile.education_level.value == 'other' else '' }}>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                                                        <div class="mb-3">
                                <label for="field_of_study" class="form-label">Field of Study</label>
                                <input type="text" class="form-control" id="field_of_study" name="field_of_study" 
                                       placeholder="e.g., Computer Science, Business Administration, Engineering" value="{{ profile.field_of_study if profile and profile.field_of_study else '' }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Skills and Technologies -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-code me-2"></i>Skills & Technologies *</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="skills_technologies" class="form-label">Skills and Technologies</label>
                        <textarea class="form-control" id="skills_technologies" name="skills_technologies" rows="4" 
                                  placeholder="Enter your skills and technologies, separated by commas (e.g., Python, JavaScript, React, AWS)" required>{{ profile.skills_technologies | join(', ') if profile and profile.skills_technologies else '' }}</textarea>
                        <div class="form-text">List your technical skills, programming languages, frameworks, and tools.</div>
                    </div>
                </div>
            </div>

            <!-- Work Preferences -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Work Preferences</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="work_arrangement_preference" class="form-label">Work Arrangement *</label>
                                <select class="form-select" id="work_arrangement_preference" name="work_arrangement_preference" required>
                                    <option value="">Select work arrangement</option>
                                    <option value="any" {{ 'selected' if profile and profile.work_arrangement_preference and profile.work_arrangement_preference.value == 'any' else '' }}>Any</option>
                                    <option value="remote" {{ 'selected' if profile and profile.work_arrangement_preference and profile.work_arrangement_preference.value == 'remote' else '' }}>Remote</option>
                                    <option value="hybrid" {{ 'selected' if profile and profile.work_arrangement_preference and profile.work_arrangement_preference.value == 'hybrid' else '' }}>Hybrid</option>
                                    <option value="on_site" {{ 'selected' if profile and profile.work_arrangement_preference and profile.work_arrangement_preference.value == 'on_site' else '' }}>On-site</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                            <label for="preferred_locations" class="form-label">Preferred Locations</label>
                            <input type="text" class="form-control" id="preferred_locations" name="preferred_locations" 
                                       placeholder="e.g., San Francisco, CA, Remote" value="{{ profile.preferred_locations | join(', ') if profile and profile.preferred_locations else '' }}">
                                <div class="form-text">Enter preferred locations, separated by commas.</div>
                    </div>
                </div>
            </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="salary_min" class="form-label">Minimum Salary (USD)</label>
                                <input type="number" class="form-control" id="salary_min" name="salary_min" min="0" step="1000" 
                                       placeholder="e.g., 80000" value="{{ profile.salary_min if profile else '' }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="salary_max" class="form-label">Maximum Salary (USD)</label>
                                <input type="number" class="form-control" id="salary_max" name="salary_max" min="0" step="1000" 
                                       placeholder="e.g., 150000" value="{{ profile.salary_max if profile else '' }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="col-lg-4">
        <!-- Profile Completion Guide -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Profile Completion Guide</h6>
            </div>
            <div class="card-body">
                <p class="small text-muted">Complete your profile to get better job matches:</p>
                <ul class="small text-muted">
                    <li>Years of Experience</li>
                    <li>Experience Level</li>
                    <li>Education Level</li>
                    <li>Skills & Technologies</li>
                    <li>Work Arrangement Preference</li>
                </ul>
                <div class="alert alert-info small">
                    <i class="fas fa-lightbulb me-1"></i>
                    <strong>Tip:</strong> The more complete your profile, the better job recommendations you'll receive.
                </div>
            </div>
        </div>

        <!-- Profile Statistics -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Profile Statistics</h6>
            </div>
            <div class="card-body">
                <div id="profile-stats">
                    <p class="text-muted small">Loading profile statistics...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Save Success Modal -->
<div class="modal fade" id="saveSuccessModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Profile Updated</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Your profile has been updated successfully!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="errorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Error</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="error-message">An error occurred while saving your profile.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
let profileData = null;
let profileOptions = null;

// Load profile data on page load
document.addEventListener('DOMContentLoaded', function() {
    loadProfileData();
    checkProfileCompletion();
});

function loadProfileData() {
    // For now, we'll just populate with empty values
    // In a real implementation, you'd load from the server
    // Profile data loading not implemented yet
}

function checkProfileCompletion() {
    // For now, we'll just show incomplete
    updateCompletionBadge(false);
}

function updateCompletionBadge(isComplete) {
    const badge = document.getElementById('completion-badge');
    if (isComplete) {
        badge.className = 'badge bg-success';
        badge.textContent = 'Profile Complete';
    } else {
        badge.className = 'badge bg-warning';
        badge.textContent = 'Profile Incomplete';
    }
}

function saveProfile() {
    // Validate required fields
    const experienceLevel = document.getElementById('experience_level').value;
    const educationLevel = document.getElementById('education_level').value;
    const workArrangement = document.getElementById('work_arrangement_preference').value;
    const skillsTechnologies = document.getElementById('skills_technologies').value.trim();
    
    if (!experienceLevel) {
        showError('Please select an experience level.');
        return;
    }
    
    if (!educationLevel) {
        showError('Please select an education level.');
        return;
    }
    
    if (!workArrangement) {
        showError('Please select a work arrangement preference.');
        return;
    }
    
    if (!skillsTechnologies) {
        showError('Please enter your skills and technologies.');
        return;
    }
    
    // Submit the form
    document.getElementById('profile-form').submit();
}

function showError(message) {
    document.getElementById('error-message').textContent = message;
    const modal = new bootstrap.Modal(document.getElementById('errorModal'));
    modal.show();
}
</script>
{% endblock %} 